{"version":3,"file":"v-offline.js","sources":["../src/VOffline.vue","../src/install.ts"],"sourcesContent":["<template>\n  <div :class=\"wrapperClass\">\n    <slot />\n  </div>\n</template>\n\n<script lang=\"ts\">\n  import Ping from 'ping.js';\n  import { computed, defineComponent, onBeforeUnmount, ref } from 'vue';\n  import type { ComputedRef, PropType, Ref, SetupContext } from 'vue';\n\n  type VOfflineProps = {\n    onlineClass?: string;\n    offlineClass?: string;\n    pingUrl?: string;\n  };\n\n  export default defineComponent({\n    name: 'VOffline',\n    props: {\n      onlineClass: {\n        type: String as PropType<string>,\n        required: false,\n        default: '',\n      },\n      offlineClass: {\n        type: String as PropType<string>,\n        required: false,\n        default: '',\n      },\n      pingUrl: {\n        type: String as PropType<string>,\n        required: false,\n        default: 'https://google.com',\n      },\n    },\n    setup(props: VOfflineProps, { emit }: SetupContext) {\n      // Local state\n      const isOnline: Ref<boolean> = ref(navigator.onLine || false);\n      const events: Ref<string[]> = ref(['online', 'offline', 'load']);\n      const url: Ref<string> = ref(props.pingUrl || 'https://google.com');\n\n      // Local computed\n      const wrapperClass: ComputedRef<string> = computed(() => {\n        if (isOnline.value) {\n          return typeof props.onlineClass === 'string' ? props.onlineClass : '';\n        } else {\n          return typeof props.offlineClass === 'string'\n            ? props.offlineClass\n            : '';\n        }\n      });\n\n      /**\n       * Created lifecycle hook\n       */\n      events.value.forEach((event: string) =>\n        window.addEventListener(event, check),\n      );\n\n      /**\n       * Before unmount lifecycle hook\n       */\n      onBeforeUnmount(() => {\n        // Cleanup of the event listeners\n        events.value.forEach((event: string) =>\n          window.removeEventListener(event, check),\n        );\n      });\n\n      // Local functions\n      /**\n       * Pings the URL and emits an\n       * detected online/offline event.\n       *\n       * @returns {Promise<void>}\n       */\n      async function check(): Promise<void> {\n        const p = new Ping();\n        try {\n          const ping = await p.ping(url.value);\n          if (ping || navigator.onLine) {\n            isOnline.value = true;\n            emit('detected-condition', isOnline.value);\n          }\n        } catch (error) {\n          if (error || !navigator.onLine) {\n            isOnline.value = false;\n            emit('detected-condition', isOnline.value);\n          }\n        }\n      }\n\n      return {\n        wrapperClass,\n      };\n    },\n  });\n</script>\n","import { VueConstructor } from 'vue';\nimport VOffline from './VOffline.vue';\n\nlet installed = false;\n\nconst install = {\n  install(Vue: VueConstructor): void {\n    if (installed) return;\n    Vue.component('VOffline', VOffline);\n    installed = true;\n  },\n};\n\nexport default install;\n"],"names":["_sfc_main","defineComponent","props","emit","isOnline","ref","events","url","wrapperClass","computed","event","check","onBeforeUnmount","p","Ping","error","installed","install","Vue","VOffline"],"mappings":";;;;;;;AAiBA,MAAAA,IAAAC,EAAA;AAAA,EACA,MAAA;AAAA,EACA,OAAA;AAAA,IACA,aAAA;AAAA,MACA,MAAA;AAAA,MACA,UAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IACA,cAAA;AAAA,MACA,MAAA;AAAA,MACA,UAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IACA,SAAA;AAAA,MACA,MAAA;AAAA,MACA,UAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,EACA;AAAA,EACA,MAAAC,GAAA,EAAA,MAAAC,KAAA;AAEA,UAAAC,IAAAC,EAAA,UAAA,UAAA,EAAA,GACAC,IAAAD,EAAA,CAAA,UAAA,WAAA,MAAA,CAAA,GACAE,IAAAF,EAAAH,EAAA,WAAA,oBAAA,GAGAM,IAAAC,EAAA,MACAL,EAAA,QACA,OAAAF,EAAA,eAAA,WAAAA,EAAA,cAAA,KAEA,OAAAA,EAAA,gBAAA,WACAA,EAAA,eACA,EAEA;AAKA,IAAAI,EAAA,MAAA;AAAA,MAAA,CAAAI,MACA,OAAA,iBAAAA,GAAAC,CAAA;AAAA,IAAA,GAMAC,EAAA,MAAA;AAEA,MAAAN,EAAA,MAAA;AAAA,QAAA,CAAAI,MACA,OAAA,oBAAAA,GAAAC,CAAA;AAAA,MAAA;AAAA,IACA,CACA;AASA,mBAAAA,IAAA;AACA,YAAAE,IAAA,IAAAC;AACA,UAAA;AAEA,SADA,MAAAD,EAAA,KAAAN,EAAA,KAAA,KACA,UAAA,YACAH,EAAA,QAAA,IACAD,EAAA,sBAAAC,EAAA,KAAA;AAAA,eAEAW;AACA,SAAAA,KAAA,CAAA,UAAA,YACAX,EAAA,QAAA,IACAD,EAAA,sBAAAC,EAAA,KAAA;AAAA,MAEA;AAAA,IACA;AAEA,WAAA;AAAA,MACA,cAAAI;AAAA,IAAA;AAAA,EAEA;AACA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9FA,IAAIQ,IAAY;AAEhB,MAAMC,IAAU;AAAA,EACd,QAAQC,GAA2B;AAC7B,IAAAF,MACAE,EAAA,UAAU,YAAYC,CAAQ,GACtBH,IAAA;AAAA,EACd;AACF;"}